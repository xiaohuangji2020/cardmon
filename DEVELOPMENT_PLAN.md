# Cardmon 开发计划

## 开发阶段总览

| 阶段 | 名称 | 核心目标 | 依赖 |
|------|------|----------|------|
| 0 | 技术验证 | HD-2D渲染、像素完美 | 无 |
| 1 | 核心框架 | 事件总线、数据结构、组件 | 阶段0 |
| 2 | 战斗基础 | 网格、单位、CTB | 阶段1 |
| 3 | 战斗核心 | 技能、伤害、行动力 | 阶段2 |
| 4 | 战斗扩展 | 地形、天气、Buff | 阶段3 |
| 5 | 玩家系统 | 同步率、卡牌基础 | 阶段3 |
| 6 | 宝可梦系统 | 进化、捕捉、数据提取 | 阶段5 |
| 7 | 探索系统 | 实时探索、明雷、切换 | 阶段4 |
| 8 | 元游戏 | 锻造、天赋树、存档 | 阶段6 |
| 9 | 打磨 | UI、音效、平衡 | 全部 |

---

## 阶段 0：技术验证 (MVP)

### 目标
验证 HD-2D 技术方案可行性

### 任务清单

#### 0.1 项目设置
- [ ] 配置 viewport 为 640x360
- [ ] 设置像素完美渲染（nearest 过滤）
- [ ] 配置正交摄像机

#### 0.2 Billboard 精灵验证
- [ ] 创建测试��景，放置 3D 地面
- [ ] 添加 Sprite3D，设置 billboard 模式
- [ ] 验证精灵始终面向摄像机
- [ ] 测试不同角度下的显示效果

#### 0.3 纸娃娃原型
- [ ] 创建简单的角色部件（头、身、武器）
- [ ] 组合多个 Sprite3D 形成角色
- [ ] 测试部件替换（换装）
- [ ] 验证动画播放

### 验收标准
- 3D 场景中的 2D 精灵正确显示
- 像素不模糊，边缘清晰
- 角色部件可独立替换

---

## 阶段 1：核心框架

### 目标
搭建游戏基础架构

### 任务清单

#### 1.1 全局单例
- [ ] 创建 `autoload/event_bus.gd` - 事件总线
- [ ] 创建 `autoload/game_manager.gd` - 游戏状态管理
- [ ] 在 project.godot 中注册 Autoload

#### 1.2 常量与枚举
- [ ] 创建 `core/constants/enums.gd`
  - ElementType（11种属性）
  - TerrainType（地形类型）
  - TerrainState（地形状态）
  - WeatherType（天气类型）
  - StatusEffect（异常状态）
  - MoveType（移动类型）
- [ ] 创建 `core/constants/formulas.gd`
  - 伤害公式系数
  - 属性克制倍率
  - 行动力计算参数

#### 1.3 属性克制表
- [ ] 创建 `data/type_chart.gd` - Resource 类
- [ ] 创建 `data/type_chart.tres` - 11x11 克制关系数据
- [ ] 实现克制倍率查询方法

#### 1.4 基础组件
- [ ] 创建 `core/components/health_component.gd`
  - 血量管理
  - 受伤/治疗
  - 死亡信号
- [ ] 创建 `core/components/stats_component.gd`
  - 六维属性（HP/ATK/DEF/SPATK/SPDEF/SPD）
  - 属性修改器
- [ ] 创建 `core/components/buff_component.gd`
  - Buff 添加/移除
  - 持续时间管理
  - 效果叠加

### 验收标准
- 事件总线可正常发送/接收信号
- 组件可独立工作并正确触发信号
- 属性克制查询返回正确倍率

---

## 阶段 2：战斗基础

### 目标
实现基础战斗网格和单位系统

### 任务清单

#### 2.1 网格数据层
- [ ] 创建 `gameplay/battle/grid/grid_cell.gd`
  - 位置、地形、占用者
  - 移动消耗计算
- [ ] 创建 `gameplay/battle/grid/battle_grid.gd`
  - 网格初始化
  - 格子查询（坐标、范围）
  - 占用管理

#### 2.2 网格渲染层
- [ ] 创建 `gameplay/battle/grid/grid_renderer.gd`
  - 网格可视化
  - 高亮显示（移动范围、攻击范围）
  - 格子选择反馈

#### 2.3 寻路系统
- [ ] 创建 `core/utils/grid_utils.gd`
  - A* 寻路算法
  - 移动范围计算
  - 路径可视化

#### 2.4 单位基类
- [ ] 创建 `gameplay/units/base_unit.gd`
  - 组件挂载（Health, Stats, Buff）
  - 网格位置
  - 移动方法
  - 行动力属性

#### 2.5 CTB 回合系统
- [ ] 创建 `gameplay/battle/turn/action_queue.gd`
  - 单位队列管理
  - 时间片推进
  - 下一行动单位计算
- [ ] 创建 `gameplay/battle/turn/turn_manager.gd`
  - 回合流程控制
  - 回合开始/结束事件
  - UI 更新通知

#### 2.6 测试场景
- [ ] 创建 `scenes/test/grid_test.tscn`
  - 放置网格
  - 放置测试单位
  - 验证移动和回合切换

### 验收标准
- 网格正确显示，可点击选择
- 单位可在网格上移动
- CTB 按速度正确排序行动顺序
- 移动消耗行动力，回合正确切换

---

## 阶段 3：战斗核心

### 目标
实现技能系统和伤害计算

### 任务清单

#### 3.1 技能数据结构
- [ ] 创建 `data/skills/skill_data.gd`
  - 技能ID、名称、描述
  - 属性类型
  - 范围类型（单体/AOE/线性）
  - 基础伤害/效果
  - 行动力消耗

#### 3.2 技能执行系统
- [ ] 创建 `gameplay/battle/skills/skill_executor.gd`
  - 技能释放流程（前摇→判定→伤害→后处理）
  - 目标选择验证
  - 范围计算
- [ ] 创建 `gameplay/battle/skills/damage_calculator.gd`
  - 伤害公式实现
  - 属性克制计算
  - 暴击/闪避判定

#### 3.3 行动力系统完善
- [ ] 实现 `action_point.gd`
  - 行动力消耗（移动+技能）
  - 透支机制（负数行动力）
  - 筋疲力竭状态
  - 回复速度计算

#### 3.4 基础 AI
- [ ] 创建 `gameplay/units/ai/battle_ai.gd`
  - 简单决策（攻击最近敌人）
  - 移动评估
  - 技能选择

#### 3.5 战斗场景
- [ ] 创建 `scenes/battle/battle_scene.tscn`
  - 战斗管理器
  - 基础战斗 UI
  - 技能选择界面

### 验收标准
- 单位可释放技能造成伤害
- 伤害计算考虑属性克制
- 行动力透支触发筋疲力竭
- AI 可自动进行简单战斗

---

## 阶段 4：战斗扩展

### 目标
实现地形、天气和状态系统

### 任务清单

#### 4.1 地形系统
- [ ] 创建 `data/terrains/terrain_data.gd`
  - 地形类型定义
  - 移动消耗修正
  - 每回合效果
- [ ] 创建 `gameplay/terrain/terrain_manager.gd`
  - 地形状态管理
  - 地形交互（火烧草地→燃烧地面）
  - 地形传播（元胞自动机）
- [ ] 实现地形效果
  - 燃烧（每回合扣血）
  - 冰面（滑行）
  - 水域（限制移动）
  - 草地（隐蔽）

#### 4.2 天气系统
- [ ] 创建 `gameplay/weather/weather_manager.gd`
  - 天气状态
  - 天气效果（伤害加成、命中修正）
  - 天气切换

#### 4.3 Buff/异常状态
- [ ] 扩展 `buff_component.gd`
  - 中毒、烧伤、麻痹、迟缓、冰冻、睡眠、失明
  - 状态触发时机
  - 状态免疫/抵抗

#### 4.4 胜负判定
- [ ] 创建 `gameplay/battle/referee.gd`
  - 胜利条件检测
  - 失败条件检测
  - 战斗结算

### 验收标准
- 地形正确影响移动和战斗
- 地形可被技能改变
- 天气效果正确生效
- 异常状态正确触发和结算

---

## 阶段 5：玩家系统

### 目标
实现玩家单位和同步率系统

### 任务清单

#### 5.1 玩家单位
- [ ] 创建 `gameplay/units/player/player_unit.gd`
  - 继承 base_unit
  - 玩家特有属性
  - 死亡=战斗失败

#### 5.2 同步率系统
- [ ] 创建 `gameplay/units/player/sync_rate.gd`
  - 同步率值和上限
  - 产出：时间恢复、攻击、击杀
  - 消耗：召唤、刷卡、合体
  - 召唤惩罚（上限降低、恢复变慢）

#### 5.3 卡牌系统基础
- [ ] 创建 `data/cards/card_data.gd`
  - 卡牌类型（强化/道具/捕捉/技能）
  - 同步率消耗
  - 冷却时间
- [ ] 创建 `gameplay/cards/card_manager.gd`
  - 卡牌使用
  - 冷却管理
  - 距离检测（刷卡范围）

#### 5.4 刷卡机制
- [ ] 实现刷卡流程
  - 选择卡牌
  - 选择目标
  - 距离验证
  - 效果执行

### 验收标准
- 玩家可在战斗中行动
- 同步率正确产出和消耗
- 卡牌可正常使用并进入冷却
- 刷卡距离限制生效

---

## 阶段 6：宝可梦系统

### 目标
实现宝可梦完整系统

### 任务清单

#### 6.1 宝可梦数据
- [ ] 创建 `data/pokemon/pokemon_data.gd`
  - 种族值
  - 属性
  - 特性
  - 可学技能
  - 进化链
- [ ] 创建 `gameplay/units/pokemon/pokemon_unit.gd`
  - 宝可梦实例
  - 等级/经验
  - 当前技能

#### 6.2 进化系统
- [ ] 创建 `gameplay/units/pokemon/evolution.gd`
  - 常规进化（永久）
  - Mega 进化（临时）
  - 合体进化（玩家+宝可梦）

#### 6.3 捕捉系统
- [ ] 创建 `gameplay/units/pokemon/capture.gd`
  - 数据碎片收集
  - 完美捕捉（刷卡）
  - 合成宝可梦

#### 6.4 数据提取
- [ ] 实现玩家提取宝可梦能力
  - 属性提取
  - 特性提取
  - 技能提取（转化为玩家版本）
  - 提取限制（不可上场）

### 验收标准
- 宝可梦可升级学习技能
- 进化系统正常工作
- 捕捉流程完整
- 数据提取正确影响玩家能力

---

## 阶段 7：探索系统

### 目标
实现实时探索和战斗切换

### 任务清单

#### 7.1 探索控制
- [ ] 创建 `gameplay/exploration/exploration_controller.gd`
  - 玩家实时移动（WASD/点击）
  - 宝可梦跟随
  - 摄像机跟随

#### 7.2 明雷系统
- [ ] 创建 `gameplay/exploration/spawning/spawn_manager.gd`
  - 野生宝可梦刷新
  - 警戒范围
  - 行为（逃跑/战斗）
- [ ] 创建 `gameplay/units/ai/exploration_ai.gd`
  - 巡逻行为
  - 追击行为

#### 7.3 交互系统
- [ ] 创建 `gameplay/exploration/interaction/interactable.gd`
  - NPC 对话
  - 宝箱
  - 机关

#### 7.4 战斗切换
- [ ] 实现无缝切换
  - 状态快照
  - 网格生成
  - 位置对齐（Snap to Grid）
  - 摄像机过渡

### 验收标准
- 玩家可自由探索
- 明雷正确触发战斗
- NPC 可交互
- 探索↔战斗切换流畅

---

## 阶段 8：元游戏

### 目标
实现锻造、天赋和存档

### 任务清单

#### 8.1 卡牌锻造
- [ ] 创建 `gameplay/cards/forge/forge_manager.gd`
  - 基础强化（数值提升）
  - 模组系统（范围/形状/控制/地形/吸血）
  - 容量限制

#### 8.2 天赋树
- [ ] 创建 `gameplay/units/player/talent_tree.gd`
  - 天赋节点
  - 解锁条件
  - 效果应用

#### 8.3 存档系统
- [ ] 创建 `autoload/save_manager.gd`
  - 玩家数据序列化
  - 宝可梦数据序列化
  - 卡牌数据序列化
  - 进度数据

### 验收标准
- 卡牌可锻造强化
- 天赋树可解锁生效
- 存档/读档正常工作

---

## 阶段 9：打磨

### 目标
完善游戏体验

### 任务清单

#### 9.1 UI 完善
- [ ] 战斗 HUD
- [ ] 回合顺序条
- [ ] 卡牌面板
- [ ] 状态显示
- [ ] 伤害飘字

#### 9.2 视觉效果
- [ ] 技能特效
- [ ] 地形特效
- [ ] 天气特效
- [ ] 过渡动画

#### 9.3 音效
- [ ] BGM
- [ ] 技能音效
- [ ] UI 音效

#### 9.4 平衡调整
- [ ] 数值平衡
- [ ] 同步率经济
- [ ] AI 优化

---

## 里程碑

| 里程碑 | 包含阶段 | 可玩内容 |
|--------|----------|----------|
| M1 技术验证 | 0 | HD-2D 渲染 Demo |
| M2 战斗原型 | 1-3 | 基础战斗可玩 |
| M3 完整战斗 | 4-6 | 完整战斗系统 |
| M4 完整循环 | 7-8 | 探索+战斗循环 |
| M5 发布版本 | 9 | 完整游戏 |

---

## 注意事项

1. **每个阶段完成后进行测试**，确保功能稳定再进入下一阶段
2. **优先实现核心玩法**，美术资源可用占位符
3. **保持代码模块化**，方便后期调整和扩展
4. **定期备份**，使用 Git 进行版本控制
5. **记录设计决策**，方便后期回顾和调整
